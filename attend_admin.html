<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Football_Record_Statistics">
<meta name="author" content="LoonyHyun">
<meta property="og:url" content="https://loonyhyun.cafe24.com/">
<meta property="og:title" content="바론 FC 경기 기록실">
<meta property="og:type" content="website">
<meta property="og:image" content="https://loonyhyun.cafe24.com/football_tpm/img/main.png">
<meta property="og:description" content="바론 FC의 경기 기록실 입니다.">
<title>출석 체크 확인</title>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<script src="/football_tpm/bootstrap-datepicker.min.js"></script>
<script src="/football_tpm/bootstrap-datepicker.ko.min.js"></script>
<link href="/football_tpm/bootstrap-datepicker.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

<script src="/football_tpm/team.js"></script>
<link href="/football_tpm/team.css" rel="stylesheet">

<script>
	$(document).ready(function(){
		$("#headers").load("/football_tpm/header.html", function(){
			getTeam();
			$("#header_attend").addClass("text-warning").removeClass("text-white");
			$("#drop_header").text($("#drop_header_attend").text());
		});
		setLayout();
		getInitAttend();
		getInitAttendPlayer();
	});

	$(window).resize(function(){
		setLayout();
	});

	var selectedPlayers = [];
	function getInitAttendPlayer(){
		$.ajax({
			type : "post",
			url : '/football_tpm/get.php',
			data : {
				cmd : "player",
				id : 1,
			},
			dataType : "json",
			success : function(data) {
				for(var i=0; i<data.length; i++){
					if(selectedPlayers.indexOf(data[i]["player_id"]) < 0){
						$("#ATTEND_PLAYERS").append("<tr><td>"+data[i]["player_name"]+"</td>"
							+"<td><button type='button' class='btn btn-sm btn-danger' onclick=\"setAttendTeam('a', '"+data[i]["player_id"]+"');\">A팀</button></td>"
							+"<td><button type='button' class='btn btn-sm btn-primary' onclick=\"setAttendTeam('b', '"+data[i]["player_id"]+"');\">B팀</button></td>"
							+"</tr>");
					}
				}
			},
			error : function(err) {
				alert("오류발생 관리자에게 문의하세요.")
			}
		});
	}

	function setAttendInit(){
		if(confirm("초기화 시 등록된 인원이 없어집니다. 되돌릴 수 없습니다.\n초기화 하시겠습니까?")){
			$.ajax({
			type : "post",
			url : '/football_tpm/save.php',
			data : {
				cmd : "attend_init",
				id : 1,
				checker : "baron"
			},
			success : function(data) {
				if(data == "ok"){
					alert("초기화 완료");
					location.reload();
				}else{
					alert("초기화 실패");
				}
			},
			error : function(err) {
				alert("오류발생 관리자에게 문의하세요.")
			}
		});
		}
	}

	function moveAttend(type, pid){
		$.ajax({
			type : "post",
			url : '/football_tpm/save.php',
			data : {
				cmd : "attend_del",
				id : 1,
				checker : "baron",
				player_id : pid
			},
			success : function(data) {
				if(data == "ok"){
					$.ajax({
						type : "post",
						url : '/football_tpm/save.php',
						data : {
							cmd : "attend",
							id : 1,
							teamtype : type,
							player_id : pid
						},
						success : function(data) {
							if(data == "ok"){
								location.reload();
							}else{
								alert("실패");
							}
						},
						error : function(err) {
							alert("오류발생 관리자에게 문의하세요.")
						}
					});
				}else{
					alert("제거 실패");
				}
			},
			error : function(err) {
				alert("오류발생 관리자에게 문의하세요.")
			}
		});
	}

	function delAttend(pid){
		$.ajax({
			type : "post",
			url : '/football_tpm/save.php',
			data : {
				cmd : "attend_del",
				id : 1,
				checker : "baron",
				player_id : pid
			},
			success : function(data) {
				if(data == "ok"){
					alert("제거 완료");
					location.reload();
				}else{
					alert("제거 실패");
				}
			},
			error : function(err) {
				alert("오류발생 관리자에게 문의하세요.")
			}
		});
	}

	function setAttendTeam(type, pid){
		$.ajax({
			type : "post",
			url : '/football_tpm/save.php',
			data : {
				cmd : "attend",
				id : 1,
				teamtype : type,
				player_id : pid
			},
			success : function(data) {
				if(data == "ok"){
					location.reload();
				}else{
					alert("실패");
				}
			},
			error : function(err) {
				alert("오류발생 관리자에게 문의하세요.")
			}
		});
	}

	function getInitAttend(){
		$.ajax({
			type : "post",
			url : '/football_tpm/get.php',
			data : {
				cmd : "attend",
				id : 1,
			},
			dataType : "json",
			success : function(data) {
				var teamAidx = 0;
				var teamBidx = 0;
				for(var i=0; i<data.length; i++){
					if(data[i]["team_type"] == "a"){
						teamAidx++;
						$("#ATTEND_TEAM_A").append("<tr><td>"+teamAidx+"</td><td>"+data[i]["player_name"]+"</td>"
							+"<td><button type='button' class='btn btn-sm btn-dark' onclick=\"delAttend('"+data[i]["player_id"]+"');\">DEL</button> "
								+"<button type='button' class='btn btn-sm btn-primary' onclick=\"moveAttend('b', '"+data[i]["player_id"]+"');\">MOVE</button></td></tr>");
						selectedPlayers.push(data[i]["player_id"]);
					}
					else if(data[i]["team_type"] == "b"){
						teamBidx++;
						$("#ATTEND_TEAM_B").append("<tr><td>"+teamBidx+"</td><td>"+data[i]["player_name"]+"</td>"
							+"<td><button type='button' class='btn btn-sm btn-dark' onclick=\"delAttend('"+data[i]["player_id"]+"');\">DEL</button> "
								+"<button type='button' class='btn btn-sm btn-danger' onclick=\"moveAttend('a', '"+data[i]["player_id"]+"');\">MOVE</button></td></tr>");
						selectedPlayers.push(data[i]["player_id"]);
					}
				}
			},
			error : function(err) {
				alert("오류발생 관리자에게 문의하세요.")
			}
		});
	}
</script>
<style>
</style>
</head>
<body>

    <div id="headers"></div>
	<div class="container">
		<div class="row">&nbsp;</div>
		<div class="row">
			<div class="col">
				<button type="button" class="btn btn-warning" onclick="setAttendInit();">초기화</button>
			</div>
		</div>
		<div class="row">&nbsp;</div>
		<div class="row">
			<div class="col">
				<table class="table auto_font_size" id="ATTEND_TEAM_A">
					<tr style="background: #ffa2a2;"><th colspan="3">A팀</th></tr>
				</table>
			</div>
			<div class="col">
				<table class="table auto_font_size" id="ATTEND_TEAM_B">
					<tr style="background: #9d9dff;"><th colspan="3">B팀</th></tr>
				</table>
			</div>
		</div>
		<div class="row">&nbsp;</div>
		<div class="row">
			<div class="col">
				<table class="table auto_font_size" id="ATTEND_PLAYERS">
					<tr style="background: #888888;"><th colspan="3">등록필요</th></tr>
				</table>
			</div>
		</div>

		<div id='footers'></div>
	</div>
</body>
</html>