<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Football_Record_Statistics">
<meta name="author" content="LoonyHyun">
<meta property="og:url" content="https://loonyhyun.cafe24.com/">
<meta property="og:title" content="바론 FC 경기 기록실">
<meta property="og:type" content="website">
<meta property="og:image" content="https://loonyhyun.cafe24.com/football_tpm/img/main.png">
<meta property="og:description" content="바론 FC의 경기 기록실 입니다.">
<title>Best11</title>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<script src="/football_tpm/bootstrap-datepicker.min.js"></script>
<script src="/football_tpm/bootstrap-datepicker.ko.min.js"></script>
<link href="/football_tpm/bootstrap-datepicker.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

<script src="/football_tpm/team.js"></script>
<link href="/football_tpm/team.css" rel="stylesheet">

<style>
	.bestPlayer {max-width:120px;}
</style>
<script>
	$(document).ready(function(){
		$("#headers").load("/football_tpm/header.html", function(){
			var target_header = "best";
			getTeam();
			$("#header_" + target_header).addClass("text-warning").removeClass("text-white");
			$("#drop_header").text($("#drop_header_" + target_header).text());
		});
		setLayout();
		getSamplePlayers();
	});

	$(window).resize(function(){
		setLayout();
	});

	function setSelectedPosition(){
		$("#POSITION_ATT").html("");
		$("#POSITION_MID").html("");
		$("#POSITION_DEF").html("");

		var val = $("#REG_FORMATION").val();
		if(val == ""){
			return;
		}
		var def = parseInt(val.substring(0, 1));
		var mid = parseInt(val.substring(1, 2));
		var att = parseInt(val.substring(2, 3));

		var playerCnt = 0;
		for(var i=0; i<att; i++, playerCnt++){
			var str  = "<div class='col'>";
				str += "<select class='bestPlayer form-select form-select-lg' name='bestPlayer' id='player_" + playerCnt + "'></select>";
				str += "</div>";
			$("#POSITION_ATT").append(str);
		}

		if(mid == 5){
			$("#POSITION_MID").html("<div class='row' id='POSITION_MID_1'></div><div class='row' id='POSITION_MID_2'></div>");
		}
		for(var i=0; i<mid; i++, playerCnt++){
			if(mid == 5){
				var stylevalue = " style='' ";
				if(i == 0){
					stylevalue = " style='float:right;' ";
				}else if(i == 2){
					stylevalue = " style='float:left;' ";
				}else if(i == 3){
					stylevalue = " style='float:left;' ";
				}else if(i == 4){
					stylevalue = " style='float:right;' ";
				}
				if(i < 3){
					var str  = "<div class='col'>";
						str += "<select class='bestPlayer form-select form-select-lg' name='bestPlayer' " +stylevalue+" id='player_" + playerCnt + "'></select>";
						str += "</div>";
					$("#POSITION_MID_1").append(str);
				}else{
					var str  = "<div class='col'>";
						str += "<select class='bestPlayer form-select form-select-lg' name='bestPlayer' " +stylevalue+" id='player_" + playerCnt + "'></select>";
						str += "</div>";
					$("#POSITION_MID_2").append(str);
				}
			}else{
				var str  = "<div class='col'>";
					str += "<select class='bestPlayer form-select form-select-lg' name='bestPlayer' " +stylevalue+" id='player_" + playerCnt + "'></select>";
					str += "</div>";
				$("#POSITION_MID").append(str);
			}
		}
		for(var i=0; i<def; i++, playerCnt++){
			var str  = "<div class='col'>";
				str += "<select class='bestPlayer form-select form-select-lg' name='bestPlayer' id='player_" + playerCnt + "'></select>";
				str += "</div>";
			$("#POSITION_DEF").append(str);
		}
		var str  = "<div class='col'>";
			str += "<select class='bestPlayer form-select form-select-lg' name='bestPlayer' id='player_10'></select>";
			str += "</div>";
		$("#POSITION_KEEP").append(str);

		$("select[name=bestPlayer]").each(function(){
			$(this).append($("#PLAYER_SELECT_SAMPLE").html());
		});
	}



    function getSamplePlayers()
    {
        
        $.ajax({
            type : "post",
            url : './get.php',
            data : {
                cmd : "players",
                id : 1
            },
            dataType : "json",
            success : function(data) {
                for (var i = 0; i < data.length; i++) {
                    var playerId = data[i]["player_id"];
					var str = "<option value='"+playerId+"'>";
						str += data[i]["player_name"];
						str += "</option>";
                    $("#PLAYER_SELECT_SAMPLE").append(str);
                }
            },
            error : function(err) {
                alert("오류발생 관리자에게 문의하세요.")
            }
        });
    }

	function saveBestPlayer(){
		if($("#REG_NAME").val() == ""){
			alert("작성자를 입력하세요.");
			return;
		}
		if($("#REG_FORMATION").val() == ""){
			alert("포메이션을 선택하세요.");
			return;
		}
		var chkPlayer = "$";
		for(var i=0; i<10; i++){
			if($("#player_" + i).val() == "" || $("#player_" + i).val() == undefined){
				alert("선수를 선택하세요.");
				return;
			}
			if(chkPlayer.indexOf("$" + $("#player_" + i).val() + "$") > -1){
				alert("선수 중복입니다. 정확히 선택해주세요.");
				return;
			}
			chkPlayer += $("#player_" + i).val() + "$";
		}
        $.ajax({
            type : "post",
            url : './save.php',
            data : {
                cmd : "best11",
                id : 1,
				reg_name : $("#REG_NAME").val(),
				reg_formation: $("#REG_FORMATION").val(),
				player_0: $("#player_0").val(),
				player_1: $("#player_1").val(),
				player_2: $("#player_2").val(),
				player_3: $("#player_3").val(),
				player_4: $("#player_4").val(),
				player_5: $("#player_5").val(),
				player_6: $("#player_6").val(),
				player_7: $("#player_7").val(),
				player_8: $("#player_8").val(),
				player_9: $("#player_9").val(),
				player_10: $("#player_10").val()
            },
            success : function(data) {
				if(data == "ok"){
					alert("등록되었습니다.");
				}else{
					alert("등록 되지 않았습니다. 다시 시도해주세요.");
				}
				location.href = "/football_tpm/best.html";
            },
            error : function(err) {
                alert("오류발생 관리자에게 문의하세요.")
            }
        });
	}

	function viewBestPlayer(){
		
        $.ajax({
            type : "post",
            url : './get.php',
            data : {
                cmd : "best11stat",
                id : 1
            },
            dataType : "json",
            success : function(data) {
				var tmp = data[0];

				var view = $("#VIEW_BEST_PLAYER_DIV");
				view.html("");
				var regFormation = tmp["reg_formation"];
				var totalCnt = tmp["total_cnt"];
				view.append("<p>포메이션: " + regFormation + "</p><p>총 횟수: " + totalCnt + "</p>")

				for(var i=0; i<10; i++){
					if(data.length > i+1){
						tmp = data[i+1];
						var cnt = tmp["cnt"];
						view.append("<p>"+tmp["player_name"] + ": " + cnt + " 회 (" + (cnt * 100 / totalCnt) + " %)</p>");
					}
				}
            },
            error : function(err) {
                alert("오류발생 관리자에게 문의하세요.")
            }
        });
	}
</script>
<style>
</style>
</head>
<body>

    <div id="headers"></div>
	<div class="container">
		<div class="row">&nbsp;</div>
		<h2>2021년 BEST 11 을 뽑아주세요.</h2>
		<div class="input-group">
			<span class="input-group-text">작성자</span>
			<input type="text" class="form-control" id="REG_NAME" placeholder="작성자" value=""/>
		</div>
		<div class="row">&nbsp;</div>
		<div class="input-group">
			<span class="input-group-text">포메이션 선택</span>
			<select class="form-select" aria-label="포메이션 선택" id="REG_FORMATION" onchange="setSelectedPosition(this);">
				<option selected value="">선택하세요.</option>
				<option value="442">4-4-2</option>
				<option value="433">4-3-3</option>
				<option value="424">4-2-4</option>
				<option value="352">3-5-2</option>
				<option value="343">3-4-3</option>
				<option value="334">3-3-4</option>
			  </select>
		</div>
		<div class="row">&nbsp;</div>
		<div class="row">
			<table class="table" style="height:500px; text-align: center;vertical-align: middle;">
				<tr class="table-primary">
					<td>
						<div class="row" id="POSITION_ATT" style="text-align: -webkit-center;">&nbsp;</div>
					</td>
				</tr>
				<tr class="table-success">
					<td>
						<div class="row" id="POSITION_MID" style="text-align: -webkit-center;">&nbsp;</div>
					</td>
				</tr>
				<tr class="table-warning">
					<td>
						<div class="row" id="POSITION_DEF" style="text-align: -webkit-center;">&nbsp;</div>
					</td>
				</tr>
				<tr class="table-secondary">
					<td>
						<div class="row" id="POSITION_KEEP" style="text-align: -webkit-center;">&nbsp;</div>
					</td>
				</tr>
			</table>
			<select id="PLAYER_SELECT_SAMPLE" style="display: none;">
				<option value="">N/A</option>
			</select>
		</div>
		<div class="row">&nbsp;</div>
		<div class="row"><button type="button" class="btn btn-success" onclick="saveBestPlayer();">등록</button></div>
		<div class="row">&nbsp;</div>
		<!--
		<div class="row"><button type="button" class="btn btn-link" onclick="viewBestPlayer();">보기</button></div>
		<div class="row">&nbsp;</div>
		<div class="row">
			<div class="col" id="VIEW_BEST_PLAYER_DIV"></div>
		</div>
		<div class="row">&nbsp;</div>
		-->
		<div id='footers'></div>
	</div>
</body>
</html>